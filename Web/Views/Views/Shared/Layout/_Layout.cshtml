@*[security|||shared/layout/_layout.cshtml|||hercules]*@
@using Es.Riam.Gnoss.Web.MVC.Models
@using Es.Riam.Gnoss.Web.MVC.Controles.Helper
@using Es.Riam.Gnoss.Web.MVC.Models.ViewModels
@using Es.Riam.Gnoss.Web.MVC.Models.Administracion
@using Es.Riam.Gnoss.AD.ServiciosGenerales
@using Es.Riam.Gnoss.Web.MVC.Controllers
@using Es.Riam.Gnoss.Web.MVC.Controllers.Administracion
@using Es.Riam.Gnoss.Web.Controles
@using Newtonsoft.Json
@{ CommunityModel Comunidad = Html.GetComunidad();
    UserIdentityModel IdentidadActual = Html.GetIdentidadActual();
    string avisoCookies = Html.GetCookiesWarning();
}

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML+RDFa 1.0//EN" "http://www.w3.org/MarkUp/DTD/xhtml-rdfa-1.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="@Html.GetUtilIdiomas().LanguageCode" xmlns:og="http://ogp.me/ns#">
<head>


    @if (Comunidad != null && Comunidad.ProjectExtraHTMLList != null)
    {
        @Html.PartialView("../Shared/ProyectoElementoHTML", Comunidad.ProjectExtraHTMLList.Where(a => a.Ubication == UbicacionHtmlProyecto.BeginHead).ToList());
    }

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    @Html.PartialView("../Shared/Head/_Metas")

    <title>@Html.GetTituloPagina()</title>

    <link id="IMGfavicon" rel="shortcut icon" type="image/ico" href="@Html.GetFavicon()" />

    @if (!string.IsNullOrEmpty(Html.GetUrlCanonical()))
    {
        <link rel="canonical" href="@Html.GetUrlCanonical()" />
    }
    @if (Html.GetCabecera() != null && Html.GetCabecera().MultiLingualLinks != null)
    {
        if (Html.GetCabecera().MultiLingualLinks.Keys.Contains(Html.GetUtilIdiomas().LanguageCode))
        {
            <link rel="alternate" hreflang="@Html.GetUtilIdiomas().LanguageCode" href="@Html.GetCabecera().MultiLingualLinks[Html.GetUtilIdiomas().LanguageCode].Value" />
        }
        foreach (string language in Html.GetCabecera().MultiLingualLinks.Keys)
        {
            if (!language.Equals(Html.GetUtilIdiomas().LanguageCode))
            {
                if (Html.GetCabecera().MultiLingualLinks[language].Key)
                {
                    <link rel="alternate" hreflang="@language" href="@Html.GetCabecera().MultiLingualLinks[language].Value" />
                }
            }
        }
    } 
    @*
    @if (!string.IsNullOrEmpty(Html.GetURLRSS()))
    {
        <link rel="alternate" type="application/rss+xml" href="@Html.GetURLRSS()" />
    }
    *@
    @if (!string.IsNullOrEmpty(Html.GetURLRDF()))
    {
        <link rel="alternate" type="application/rdf+xml" href="@Html.GetURLRDF()" />
    }

    @if (Html.GetListaMetas() != null)
    {
        foreach (KeyValuePair<string, string> contentMeta in Html.GetListaMetas())
        {
            <meta name="@contentMeta.Key" content="@contentMeta.Value" />
        }
    }

    @if (Html.GetListaMetasComplejas() != null)
    {
        foreach (Dictionary<string, string> atributosMeta in Html.GetListaMetasComplejas())
        {
            System.Text.StringBuilder meta = new System.Text.StringBuilder("<meta");

            foreach (string clave in atributosMeta.Keys)
            {
                meta.Append(" ");
                meta.Append(clave);
                meta.Append("=");
                meta.Append("\"");
                meta.Append(atributosMeta[clave]);
                meta.Append("\"");
            }

            meta.Append(" />\r\n");

            @Html.Raw(meta)
        }
    }

    @Html.PartialView("../Shared/Head/_HojasDeEstilo")

    @Html.PartialView("../Shared/Head/_FicherosJavascript")

    @if (Html.GetBusquedasXml() != null)
    {
        foreach (string busqeda in Html.GetBusquedasXml())
        {
            <link rel="search" type="application/opensearchdescription+xml" href="@busqeda" />
        }
    }

    @if (Comunidad != null && Comunidad.ProjectExtraHTMLList != null)
    {
        @Html.PartialView("../Shared/ProyectoElementoHTML", Comunidad.ProjectExtraHTMLList.Where(a => a.Ubication == UbicacionHtmlProyecto.EndHead).ToList());
    }

</head>

    <body class="@Html.GetBodyClass() @(IdentidadActual == null || IdentidadActual.IsGuestUser ? " invitado" : "") @Html.GetBodyClassPestanya()">

        @if (Comunidad != null && Comunidad.ProjectExtraHTMLList != null)
        {
            @Html.PartialView("../Shared/ProyectoElementoHTML", Comunidad.ProjectExtraHTMLList.Where(a => a.Ubication == UbicacionHtmlProyecto.BeginBody).ToList());
        }

        <form method="post" target="_blank" action="" name="formularioHidden" id="formularioHidden">
            <fieldset style="display: none">
                <legend class="nota">formularioHidden</legend>
                @if (Html.GetListaInputHidden() != null)
                {
                    foreach (KeyValuePair<string, string> inputHidden in Html.GetListaInputHidden())
                    {
                        <input type="hidden" id="@inputHidden.Key" class="@inputHidden.Key" value="@inputHidden.Value" />
                    }
                }
                <input type="submit" style="display: none;" id="enviarHidden" value="enviar" title="enviar" />
            </fieldset>
        </form>

        <form method="post" target="_blank" action="" name="formularioRDF" id="formularioRDF">
            <fieldset style="display: none">
                <legend class="nota">formularioRDF</legend>
                <input type="text" style="display: none;" title="query" name="query" id="query" />
                <input type="text" style="display: none;" title="pagina" name="pagina" id="pagina" />
                <input type="submit" style="display: none;" id="rdfHack" value="enviar" title="enviar" />
            </fieldset>
        </form>

        <div style="width: 100px; height: 100px; position: absolute; display: none; left: 0px; top: 0px; z-index: 2000" class="popup">
            <img style="border-width: 0px;" alt="Cargando..." src="@Html.GetBaseUrlStatic()/img/espera.gif" />
            <p><strong>Cargando...</strong></p>
        </div>
        <div id="mascaraBlanca">
            <div class="wrap popup">
                <div class="preloader-wrapper active">
                    <div class="spinner-layer spinner-blue-only">
                        <div class="circle-clipper left">
                            <div class="circle"></div>
                        </div><div class="gap-patch">
                            <div class="circle"></div>
                        </div><div class="circle-clipper right">
                            <div class="circle"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        @Html.PartialView("../Shared/_Cabecera")

        <main role="main">
            <div class="container">
                @if (!string.IsNullOrEmpty(avisoCookies))
                {
                    <div id="phAvisoCookie">
                        <div class="info columms cookies" id="info">
                            <p class="title-panel-info"><span>Panel </span>@Html.GetText("COMMON", "INFORMACION")</p>
                            <div class="col-4">
                                <div class="box" id="divAvisoCookie">@Html.Raw(avisoCookies)</div>
                            </div>
                        </div>
                    </div>
                }
                @if (Comunidad != null && string.IsNullOrEmpty(Context.Request.Query["new-community-wizard"]) && (IdentidadActual.IsExpelled || Comunidad.ProjectState == CommunityModel.StateProject.Close || Comunidad.ProjectState == CommunityModel.StateProject.CloseTemporaly || Comunidad.ProjectState == CommunityModel.StateProject.Definition))
                {
                    <div class="aviso columms" id="info">
                        <h3><span>Panel </span>Aviso</h3>
                        <div class="col-4">
                            <div class="box">
                                @if (IdentidadActual.IsExpelled)
                                {
                                    @*Usuario expulsado*@
                                    <p>@Html.Raw(Html.GetText("COMINICIOLOGIN", "ADVERTENCIAEXPULSADO1"))</p>
                                    <p>@Html.GetText("COMMON", "MUCHASGRACIAS")</p>
                                }
                                else if (Comunidad.ProjectState == CommunityModel.StateProject.Close)
                                {
                                    <p>@Html.GetText("COMADMIN", "EXPLICACIONCERRADA", Html.GetNombreProyectoEcosistema())</p>
                                }
                                else if (Comunidad.ProjectState == CommunityModel.StateProject.CloseTemporaly)
                                {
                                    <p>@Html.GetText("COMADMIN", "EXPLICACIONCERRADATMP")</p>
                                }
                                else if (Comunidad.ProjectState == CommunityModel.StateProject.Definition)
                                {
                                    if (IdentidadActual.IsProyectAdmin)
                                    {
                                        string urlAdmin = @Html.GetGeneradorURLs().ObtenerURLAdministracionComunidad(Html.GetUtilIdiomas(), Html.GetBaseUrlIdioma(), Comunidad.ShortName, "ADMINISTRARCOMUNIDADGENERAL");
                                        //Sacamos el mensaje al administrador:
                                        switch (Comunidad.AccessType)
                                        {
                                            case CommunityModel.TypeAccessProject.Public:
                                            @Html.Raw(Html.GetText("COMINICIOLOGIN", "NOACCESODEFINICIONADMINPUBLICA", urlAdmin)) break;
                                            case CommunityModel.TypeAccessProject.Private:
                                            @Html.Raw(Html.GetText("COMINICIOLOGIN", "NOACCESODEFINICIONADMINPRIVADA", urlAdmin)) break;
                                            case CommunityModel.TypeAccessProject.Reserved:
                                            @Html.Raw(Html.GetText("COMINICIOLOGIN", "NOACCESODEFINICIONADMINRESERVADA", urlAdmin)) break;
                                            case CommunityModel.TypeAccessProject.Restricted:
                                            @Html.Raw(Html.GetText("COMINICIOLOGIN", "NOACCESODEFINICIONADMINRESTRINGIDA", urlAdmin)) break;
                                        }
                                    }
                                    else
                                    {
                                        <p>@Html.GetText("COMINICIOLOGIN", "COMUNIDADDEFINICION")</p>
                                        <p>@Html.GetText("COMINICIOLOGIN", "NOACCESODEFINICION")</p> foreach (ProfileModel admin in Comunidad.Administrators)
                                        {
                                            <p>@Html.ObtenerNombrePerfil(admin)</p>
                                        }
                                    }
                                }
                            </div>
                        </div>
                    </div>
                }
                <div class="row">
                    @RenderBody()
                </div>
            </div>
        </main>

        @Html.PartialView("../Shared/_Pie")

        <aside id="menuLateral" class="menuLateral" role="navigation">
            <div class="header">
                <div class="wrap-header">
                    <div class="menu-logo-wrapper">
                        <div class="menu-toggle">
                            <a href="javascript: void(0);" class="cerrar texto-blanco">
                                <span class="material-icons">apps</span>
                            </a>
                        </div>
                        <div class="logo-wrapper">
                            <a href="./listado.php" class="texto-blanco">
                                Hércules
                            </a>
                        </div>
                    </div>
                    <span class="material-icons cerrar">close</span>
                </div>
            </div>

            <div class="body">
                <ul class="nav pmd-sidebar-nav">
                    <li>
                        <ul>
                            @foreach (CommunityModel.TabModel pPestanya in Comunidad.Tabs)
                            {
                                <li>
                                    <a href="@pPestanya.Url">@pPestanya.Name</a>
                                </li>
                            }
                        </ul>
                    </li>
                </ul>
            </div>
        </aside>



        @RenderSection("javascript", required: false)




        @if (Comunidad != null)
        {
            try
            {
                DateTime? envioCookie = Context.Session.Get<DateTime?>("EnvioCookie");

            //Actualizo la cookie del usuario para que no caduque
            if (Context.Request.Method.Equals("GET") && !envioCookie.HasValue && !Html.GetIdentidadActual().IsGuestUser)
            {
                Context.Session.Set("EnvioCookie", DateTime.Now);

                string urlServicioLogin = Html.GetUrlServicioLogin();
                string query = string.Format("?usuarioID={0}&dominio={1}/", IdentidadActual.KeyUser, Html.GetBaseUrl());

                if (Context.Request.Scheme.Equals("http"))
                {
                    //Elimino la sesión del resto de dominios en los que había entrado el usuario
                    //para que cuando entre en ellos soliciten la cookie al servicio de login

                    if (urlServicioLogin.StartsWith("https://"))
                    {
                        //Hago una petición con http porque si no no te desconecta de los dominios que no tienen https.
                        urlServicioLogin = urlServicioLogin.Replace("https://", "http://");
                    }

                    string nuevoEnvio = "";
                    if (Context.Session.Get<object>("CrearCookieEnServicioLogin") != null)
                        {
                            nuevoEnvio = "&nuevoEnvio=true";
                        }

                        <iframe style="WIDTH:1px;HEIGHT:1px; display:none;" frameBorder="0" src="@string.Format("{0}/eliminarcookie.aspx{1}{2}", urlServicioLogin, query, nuevoEnvio)"></iframe> ////Registro el evento y lanzo la accion del proyecto
                    //ProyectoCL proyectoCL = new ProyectoCL();
                    //Dictionary<TipoProyectoEventoAccion, string> listaEventos = proyectoCL.ObtenerEventosAccionProyectoPorProyectoID(ProyectoSeleccionado.Clave, ((GnossWebPage)Page).EsBot);
                    //proyectoCL.Dispose();
                    //if (listaEventos != null && listaEventos.Count > 0)
                    //{
                    //    //comprobación existencia evento login
                    //    if (listaEventos.ContainsKey(TipoProyectoEventoAccion.Login) && (!((GnossWebPage)Page).OmitirProyectoEventoAccionLogin))
                    //    {
                    //        StringBuilder sbEventos = new StringBuilder();
                    //        sbEventos.AppendLine(listaEventos[TipoProyectoEventoAccion.Login]);
                    //        this.Page.ClientScript.RegisterStartupScript(this.GetType(), "EventoLogin", sbEventos.ToString(), true);
                    //    }
                    //}
                }
                if (Context.Session.Get<object>("CrearCookieEnServicioLogin") != null && Context.Session.Get<object>("Usuario") != null)
                    {
                    //Envío la cookie del usuario
                    Es.Riam.Gnoss.Util.Seguridad.GnossIdentity usuario = Context.Session.Get<Es.Riam.Gnoss.Util.Seguridad.GnossIdentity>("Usuario");

                        query = "usuarioID=" + usuario.UsuarioID + "&loginUsuario=" + usuario.Login + "&idioma=" + usuario.Idioma + "&personaID=" + usuario.PersonaID + "&nombreCorto=" + usuario.Login;
                        query += "&token=" + Html.GetTokenLoginUsuario();

                        <iframe style="WIDTH:1px;HEIGHT:1px; display:none;" frameBorder="0" src="@string.Format("{0}/crearCookie.aspx?{1}", urlServicioLogin, query)"></iframe> Context.Session.Remove("CrearCookieEnServicioLogin");
                    }
                }
            }
            catch (Exception ex)
            {
            }
            if (Comunidad.ProjectExtraHTMLList != null)
            {
                @Html.PartialView("../Shared/ProyectoElementoHTML", Comunidad.ProjectExtraHTMLList.Where(a => a.Ubication == UbicacionHtmlProyecto.EndBody).ToList());
            }
        }

        <div id="modal-resultados" class="modal modal-top fade modal-resultados modal-resultados-paginado" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <p class="modal-title">@Html.Translate("CATEGORIAS")</p>
                        <span class="material-icons cerrar" data-dismiss="modal" aria-label="Close">close</span>
                    </div>
                    <div class="modal-body">
                        <div class="buscador-coleccion">
                            <form>
                                <div>
                                    <span class="buscar">
                                        <input type="text" value="" class="texto">
                                        <span class="material-icons lupa">search</span>
                                    </span>
                                </div>
                            </form>
                            <script>
                                $(document).ready(function () {
                                    $(".buscador-coleccion .buscar input").on("focus", function () {
                                        $(this).val("");
                                    });
                                });
                            </script>
                        </div>
                        <div class="indice-lista no-letra facetas-wrap">
                            <div class="action-buttons-resultados">
                                <ul class="no-list-style">
                                    <li class="js-anterior-facetas-modal">
                                        <span class="material-icons">navigate_before</span>
                                        <span class="texto">Anteriores</span>
                                    </li>
                                    <li class="js-siguiente-facetas-modal">
                                        <span class="texto">Siguientes</span>
                                        <span class="material-icons">navigate_next</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="modal-tesauro" class="modal modal-top fade modal-con-buscador" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content modal-content-height">
                    <div class="modal-header">
                        <p class="modal-title"></p>
                        <span class="material-icons cerrar" data-dismiss="modal" aria-label="Close">close</span>
                    </div>
                    <div class="modal-body">
                        <div class="entityaux">
                            <div class="buscador-coleccion">
                                <div>
                                    <span class="buscar">
                                        <input type="text" value="" class="texto">
                                        <span class="material-icons lupa">search</span>
                                    </span>
                                </div>
                                <script>
                                    $(document).ready(function () {
                                        $(".buscador-coleccion .buscar input").on("focus", function () {
                                            $(this).val("");
                                        });
                                    });
                                </script>
                            </div>

                            <div class="action-buttons-resultados">
                                <ul class="no-list-style">
                                    <li class="js-plegar-facetas-modal">
                                        <span class="texto">@Html.Translate("PLEGAR")</span>
                                        <span class="material-icons">expand_less</span>
                                    </li>
                                    <li class="js-desplegar-facetas-modal">
                                        <span class="texto">@Html.Translate("DESPLEGAR")</span>
                                        <span class="material-icons">expand_more</span>
                                    </li>
                                </ul>
                            </div>

                            <ul class="listadoTesauro">

                            </ul>
                        </div>                  
                    </div>
                </div>
            </div>
        </div>

        <div id="modal-anadir-item-cv" class="modal modal-top fade modal-alertas" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <p class="modal-title"><span class="material-icons">post_add</span>Añadir</p>
                        <span class="material-icons cerrar" data-dismiss="modal" aria-label="Close">close</span>
                    </div>
                    <div class="modal-body">
                        <form class="formulario-edicion formulario-alertas">
                            <p>El item se incorporará a tu CV</p>
                            <div class="form-group">
                                <label class="control-label">¿Deseas también hacerlo público y/o enviarlo a producción científica?</label>
                            </div>
                            <div class="custom-control custom-checkbox mb-4">
                                <input type="checkbox" id="solicitar-validacion" name="solicitar-validacion" class="custom-control-input at-input">
                                <label class="custom-control-label texto-gris-claro" for="solicitar-validacion">Solicitar validación de la Universidad</label>
                            </div>
                            <div class="form-group mb-4">
                                <div class="image-uploader js-image-uploader">
                                    <div class="image-uploader__preview">
                                        <img class="image-uploader__img" alt="Imagen Usuario" src="">
                                    </div>
                                    <div class="image-uploader__drop-area">
                                        <div class="image-uploader__icon">
                                            <span class="material-icons">backup</span>
                                        </div>
                                        <div class="image-uploader__info">
                                            <p><strong>Arrastra y suelta en la zona punteada los documentos acreditativos</strong></p>
                                            <p>Imágenes en formato .PNG o .JPG</p>
                                            <p>Peso máximo de las imágenes 250 kb</p>
                                        </div>
                                    </div>
                                    <div class="image-uploader__error">
                                        <p class="ko"></p>
                                    </div>
                                </div>
                                <input type="file" class="image-uploader__input" accept="image/*">
                            </div>
                            <div class="custom-control custom-checkbox mb-4">
                                <input type="checkbox" id="hacer-publico" name="hacer-publico" class="custom-control-input">
                                <label class="custom-control-label texto-gris-claro" for="hacer-publico">Hacerlo público</label>
                            </div>
                        </form>
                        <div class="form-actions">
                            <a class="btn btn-primary uppercase">Añadir</a>
                            <a class="btn btn-link uppercase" data-dismiss="modal">Cancelar</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="modal-enviar-produccion-cientifica" class="modal modal-top fade" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <p class="modal-title"><span class="material-icons">beenhere</span>Enviar a producción científica</p>
                        <span class="material-icons cerrar" data-dismiss="modal" aria-label="Close">close</span>
                    </div>
                    <div class="modal-body">
                        <div class="formulario-edicion">
                            <div class="form-group">
                                <label class="control-label">Publicación</label>
                                <p class="title d-flex align-items-center">
                                    <span class="material-icons pr-2">article</span>
                                    <span class="texto font-weight-bold">
                                        Social Network Analysis in E-Learning Environments: A Preliminary Systematic Review.
                                    </span>
                                </p>
                            </div>
                            <div class="form-group">
                                <label class="control-label">Asigna publicación</label>
                                <div class="custom-control themed little primary custom-radio">
                                    <input type="radio" id="input-a-proyecto" name="asigna-publicacion" class="custom-control-input" checked>
                                    <label class="custom-control-label" for="input-a-proyecto">A un proyecto</label>
                                    <div class="form-group">
                                        <div class="custom-control themed little primary custom-radio">
                                            <input type="radio" id="input-proyecto-1" name="asigna-proyecto" class="custom-control-input" checked>
                                            <label class="custom-control-label" for="input-proyecto-1">Semantic Evaluation at Large Scale</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="custom-control themed little primary custom-radio">
                                            <input type="radio" id="input-proyecto-2" name="asigna-proyecto" class="custom-control-input">
                                            <label class="custom-control-label" for="input-proyecto-2">Indexación semántica de recursos de datos biomédicos franceses - movilidad</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="custom-control themed little primary custom-radio">
                                            <input type="radio" id="input-proyecto-3" name="asigna-proyecto" class="custom-control-input">
                                            <label class="custom-control-label" for="input-proyecto-3">MapInCSC (Mapping the Interaction between Semantic Representation and Control Systems: The Controlled Semantic Cognition)</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="custom-control themed little primary custom-radio">
                                    <input type="radio" id="input-a-grupo-investigacion" name="asigna-publicacion" class="custom-control-input">
                                    <label class="custom-control-label" for="input-a-grupo-investigacion">A un grupo de investigación</label>
                                </div>
                            </div>
                            <div class="form-actions">
                                <a href="" class="btn btn-primary uppercase">Enviar</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="pmd-sidebar-overlay" data-rel="menuLateralUsuario"></div>
        <aside id="menuLateralMetabuscador" class="menuLateral metabuscador">
            <div class="body custom-css-scroll">
                <div class="resultados" id="resultadosMetabuscador" data-url="Search/DoMetaSearch">
                    <ul>
                        <li class="bloque documents" data-urlcomunidad="@Comunidad.Tabs.Where(item => item.Key == new Guid("6073a387-5e95-47b3-a4d1-09a95bb7c6e5")).Select(e => e.Url).First()">
                            <p class="title">@Html.Translate("PUBLICACIONES")</p>
                            <ul>
                            </ul>
                        </li>
                        <li class="bloque persons" data-urlcomunidad="@Comunidad.Tabs.Where(item => item.Key == new Guid("f0ba215c-1629-456a-a7ac-69b63f4e986f")).Select(e => e.Url).First()">
                            <p class="title">@Html.Translate("INVESTIGADORES")</p>
                            <ul>
                            </ul>
                        </li>
                        <li class="bloque groups" data-urlcomunidad="@Comunidad.Tabs.Where(item => item.Key == new Guid("167b0af9-2299-4dd4-a889-8c36d6d2e43b")).Select(e => e.Url).First()">
                            <p class="title">@Html.Translate("GRUPOS")</p>
                            <ul>
                            </ul>
                        </li>
                        <li class="bloque projects" data-urlcomunidad="@Comunidad.Tabs.Where(item => item.Key == new Guid("51182dfb-d5b2-4d13-8595-a3949028837b")).Select(e => e.Url).First()">
                            <p class="title">@Html.Translate("PROYECTOS")</p>
                            <ul>
                            </ul>
                        </li>
                        <li class="bloque researchObjects" data-urlcomunidad="@Comunidad.Tabs.Where(item => item.Key == new Guid("fbf49f72-46a4-46f4-ba4f-00088599f717")).Select(e => e.Url).First()">
                            <p class="title">@Html.Translate("RESEARCHOBJECTS")</p>
                            <ul>
                            </ul>
                        </li>
                    </ul>
                </div>
                <div class="sugerencias" id="sugerenciasMetabuscador">
                    <p class="title">Últimas búsquedas</p>
                    <ul class="nav pmd-sidebar-nav"></ul>
                </div>
                <div class="cargadores">
                    <div class="progress-loader" id="loader-recursos-wrap">
                        <p class="progress-loader-label">Buscando recursos</p>
                    </div>
                </div>
                <div class="sinresultadosMetabuscador d-none" id="sinResultadosMetabuscador"> </div>
            </div>
        </aside>

        @if (!IdentidadActual.IsGuestUser)
        {			

			<script type="text/javascript">
				$(document).ready(function () {
					EjecutarScriptsIniciales2();
				});
			</script>
		
			<input type="hidden" id="INVESTIGADORES" value="@Html.Translate("INVESTIGADORES")"/>
			
            <div id="modal-crear-cluster" data-backdrop="static" class="modal modal-top modal-wide fade edicionRecurso  edicionCluster" tabindex="-1" role="dialog" data-eliminartext="@Html.Translate("ELIMINAR")" data-areastematicastext="@Html.Translate("AREAS_TEMATICAS")" data-descriptoresespecificostext="@Html.Translate("DESCRIPTORES_ESPECIFICOS")" data-comUrl="@Comunidad.Url" data-comKey="@Comunidad.Key.ToString()" data-cshortName="@Comunidad.ShortName" data-imguser="@Html.GetBaseUrlContent()/imagenes/proyectos/personalizacion/@Comunidad.Key.ToString()/theme/resources/iconos/person-gris.png">

                <div class="modal-dialog" role="document" >
                    <div class="modal-content">
                        <div class="modal-header">
                            <p class="modal-title"><span class="material-icons">edit</span>Editar</p>
                            <span class="material-icons cerrar" data-dismiss="modal" aria-label="Close">close</span>
                        </div>
                        <div class="modal-body">
                            <div class="formulario-edicion background-blanco">
                                <div class="d-flex flex-wrap mb-2">
                                    <div class="step-progress-wrap mb-5">
                                        <ul class="step-progress">
                                            <li class="step-progress__circle active" id="step1">
                                                <a href="javascript: void(0);">
                                                    <span class="step-progress__text current">@Html.Translate("DEFINIR_CLUSTER")</span>
                                                </a>
                                            </li>
                                            <li class="step-progress__bar"></li>
                                            <li class="step-progress__circle" id="step2">
                                                <a href="javascript: void(0);">
                                                    <span class="step-progress__text">@Html.Translate("DEFINIR_PERFILES_AREAS_INVESTIGACION")</span>
                                                </a>
                                            </li>
                                            <li class="step-progress__bar"></li>
                                            <li class="step-progress__circle" id="step3">
                                                <a href="javascript: void(0);">
                                                    <span class="step-progress__text">@Html.Translate("RECOMENDACIONES_SELECCION_INVESTIGADORES")</span>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="steps-content-wrap">
                                    <div class="p-3 mb-2 bg-danger text-white" id="error-modal-cluster" style="display:none">@Html.Translate("REVISE_ERRORES_CAMPOS_RELLENADOS")</div>
                                    <div class="p-3 mb-2 bg-danger text-white" id="error-modal-server-cluster" style="display:none">@Html.Translate("ERROR_SERVER")</div>

                                    <!-- START STEP 1 -->
                                    <div id="modal-crear-cluster-step1" class="fade show section-steps">
                                        <form class="formulario-edicion background-blanco" type="post" id="cluster-step1-form">
                                            <fieldset>
                                                <legend>Definir cluster</legend>
                                                <div class="form-group mb-5 edit-titulo">
                                                    <label class="control-label d-block">@Html.Translate("NOMBRE_TITULO_CLUSTER") *</label>
                                                    <input placeholder="@Html.Translate("INTRODUCE_NOMBRE_TITULO")" type="text" name="nombrecluster" id="nombreclusterinput" class="form-control not-outline">
                                                </div>
                                                <div class="form-group mb-5 edit-descripcion">
                                                    <label class="control-label d-block">@Html.Translate("DESCRIPCION")</label>
                                                    <textarea id="txtDescripcion" placeholder="Introduce una descripción" name="txtdescripcion" class="cke form-control recursos" cols="20" rows="2"></textarea>
                                                </div>
                                                <!-- Areas temáticas -->
                                                <div class="panel-body mb-5 edit-etiquetas pl-0">
                                                    <div class="form-group">
                                                        <label class="control-label d-block">@Html.Translate("TEMAS_INVESTIGACION") *</label>
                                                        <div class="autocompletar autocompletar-tags form-group" id="cluster-modal-sec1-tax-wrapper">
                                                            <span class="tag-list mb-4">
                                                            </span>
                                                        </div>
                                                        <a class="btn btn-outline-primary" href="javascript: void(0)">
                                                            <span class="material-icons" data-rel="cluster-modal-sec1-tax-wrapper" onclick="stepsCls.setAreasTematicas(this)">add</span>
                                                        </a>
                                                    </div>
                                                </div>
                                                <!-- -->
                                            </fieldset>
                                            <fieldset class="d-none">
                                                <div class="form-group mb-4 edit-areas-tematicas">
                                                    <label class="control-label d-block mb-3">@Html.Translate("CLASIFICACION_AREAS_TEMATICAS")</label>
                                                    <div class="custom-control themed little custom-radio">
                                                        <input type="radio" id="clasificacion-area-hercules" name="clasificacion-area" class="custom-control-input at-input" checked="">
                                                        <label class="custom-control-label" for="clasificacion-area-hercules">Hércules</label>
                                                    </div>
                                                    <div class="custom-control themed little custom-radio">
                                                        <input type="radio" id="clasificacion-area-horizon-europa" name="clasificacion-area" class="custom-control-input at-input">
                                                        <label class="custom-control-label" for="clasificacion-area-horizon-europa">Horizon Europa</label>
                                                    </div>
                                                    <div class="custom-control themed little custom-radio">
                                                        <input type="radio" id="clasificacion-area-ods" name="clasificacion-area" class="custom-control-input">
                                                        <label class="custom-control-label" for="clasificacion-area-ods">ODS</label>
                                                    </div>
                                                    <div class="custom-control themed little custom-radio">
                                                        <input type="radio" id="clasificacion-area-plan-espana" name="clasificacion-area" class="custom-control-input">
                                                        <label class="custom-control-label" for="clasificacion-area-plan-espana">Plan España Digital 2025</label>
                                                    </div>
                                                </div>
                                            </fieldset>
                                            <div class="botonera">
                                                <a class="btn btn-primary uppercase" href="javascript:stepsCls.goStep(2)" follow="nofollow">
                                                    @Html.Translate("SIGUIENTE")
                                                    <span class="material-icons">keyboard_arrow_right</span>
                                                </a>
                                            </div>
                                        </form>
                                    </div>
                                    <!-- END STEP 1 -->

                                    <!-- START STEP 2 -->
                                    <div id="modal-crear-cluster-step2" class="fade section-steps">
                                        <form class="formulario-edicion background-blanco">
                                            <fieldset>
                                                <legend>@Html.Translate("DEFINIR_PERFILES_AREAS_INVESTIGACION")</legend>
                                                <p>@Html.Translate("QUIERES_BUSCAR_INVESTIGADORES_EXPERIENCIA___")</p>
                                                <p>@Html.Translate("ORGANIZA_AREAS_PERFIL_TEMATICOS___")</p>
                                                <p class="section-title">@Html.Translate("PERFILES")</p>
                                                <div class="panel-group pmd-accordion" id="accordion_cluster" role="tablist" aria-multiselectable="true">
                                                    <div class="panel">
                                                        
                                                    </div>
                                                </div>
                                                <div class="form-group mt-4 mb-4 anadir-perfil">
                                                    <a class="btn btn-outline-primary" data-toggle="modal" data-target="#modal-anadir-perfil-cluster">@Html.Translate("ANADIR_OTRO_PERFIL") *</a>
                                                </div>
                                            </fieldset>
                                            <div class="botonera">
                                                <a href="javascript:stepsCls.goStep(1)" class="btn btn-outline-primary uppercase">
                                                    <span class="material-icons">keyboard_arrow_left</span>
                                                    Anterior
                                                </a>
                                                <a href="javascript:stepsCls.goStep(3)" class="btn btn-primary uppercase">
                                                    @Html.Translate("GUARDAR_SIGUIENTE")
                                                    <span class="material-icons">keyboard_arrow_right</span>
                                                </a>
                                            </div>
                                        </form>
                                    </div>
                                    <!-- END STEP 2 -->

                                    <!-- START STEP 3 -->
                                    <div id="modal-crear-cluster-step3" class="fade section-steps">
                                        <ul class="nav nav-tabs" id="myTab" role="tablist">
                                            <li class="nav-item">
                                                <a class="nav-link active" id="sugeridos-cluster-tab" data-toggle="tab" href="#sugeridos-cluster" role="tab" aria-controls="sugeridos-cluster" aria-selected="true">Sugeridos</a>
                                            </li>
                                            <li class="nav-item">
                                                <a class="nav-link" id="seleccionados-cluster-tab" data-toggle="tab" href="#seleccionados-cluster" role="tab" aria-controls="seleccionados-cluster" aria-selected="false">Seleccionados</a>
                                            </li>
                                        </ul>
                                        <div class="tab-content">
                                            <div class="tab-pane fade active show" id="sugeridos-cluster" role="tabpanel" aria-labelledby="sugeridos-cluster-tab">
                                                <div class="row">
                                                    <div class="col col-12 col-section-title font-weight-bold">
                                                        <div class="wrapCol">
                                                            <p>@Html.Translate("COLABORADORES")</p>
                                                            <div class="acciones-grafo">
                                                                <div class="relaciones dropdown dropdown-select">
                                                                    <a href="#" class="dropdown-toggle btn btn-outline-grey" role="button" id="dropdownRelaciones" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                                        @Html.Translate("RELACIONES"):
                                                                        <span class="texto">@Html.Translate("TODAS")</span>
                                                                    </a>
                                                                    <div class="dropdown-menu basic-dropdown dropdown-menu-right" aria-labelledby="dropdownRelaciones">
                                                                        <ul class="no-list-style">
                                                                            <li>
                                                                                <a href="javascript: void(0);" rel="nofollow" class="item-dropdown activeView">
                                                                                    <span class="textoAlternativo">@Html.Translate("RELACIONES"):</span>
                                                                                    <span class="texto">@Html.Translate("TODAS")</span>
                                                                                </a>
                                                                            </li>
                                                                            <li>
                                                                                <a href="javascript: void(0);" rel="nofollow" class="item-dropdown">
                                                                                    <span class="textoAlternativo">@Html.Translate("RELACIONES"):</span>
                                                                                    <span class="texto">@Html.Translate("PROYECTOS")</span>
                                                                                </a>
                                                                            </li>
                                                                            <li>
                                                                                <a href="javascript: void(0);" rel="nofollow" class="item-dropdown">
                                                                                    <span class="textoAlternativo">@Html.Translate("RELACIONES"):</span>
                                                                                    <span class="texto">@Html.Translate("DOCUMENTOS")</span>
                                                                                </a>
                                                                            </li>
                                                                        </ul>
                                                                    </div>
                                                                </div>
                                                                <div class="relaciones-miembros dropdown dropdown-select">
                                                                    <a href="#" class="dropdown-toggle btn btn-outline-grey" role="button" id="dropdownRelacionesMiembros" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                                        @Html.Translate("RELACIONES_ENTRE_MIEMBROS"):
                                                                        <span class="texto">Sí</span>
                                                                    </a>
                                                                    <div class="dropdown-menu basic-dropdown dropdown-menu-right" aria-labelledby="dropdownRelacionesMiembros">
                                                                        <ul class="no-list-style">
                                                                            <li>
                                                                                <a href="javascript: void(0);" rel="nofollow" class="item-dropdown activeView">
                                                                                    <span class="textoAlternativo">@Html.Translate("RELACIONES_ENTRE_MIEMBROS"):</span>
                                                                                    <span class="texto">@Html.Translate("SI")</span>
                                                                                </a>
                                                                            </li>
                                                                            <li>
                                                                                <a href="javascript: void(0);" rel="nofollow" class="item-dropdown">
                                                                                    <span class="textoAlternativo">@Html.Translate("RELACIONES_ENTRE_MIEMBROS"):</span>
                                                                                    <span class="texto">@Html.Translate("NO")</span>
                                                                                </a>
                                                                            </li>
                                                                        </ul>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col col-12 col-grafo-title font-weight-bold">
                                                        <div class="grafico-wrap">
                                                            <div></div>
                                                            <div class="graph-controls">
                                                                <ul class="no-list-style d-flex align-items-center">
                                                                    <li class="control remove-control" id="removeNodesCollaboratorsCluster">
                                                                        <span class="material-icons">remove</span>
                                                                    </li>
                                                                    <li class="control text-control">
                                                                        <span id="numNodosCollaboratorsCluster">10</span> @Html.Translate("NODOS")
                                                                    </li>
                                                                    <li class="control add-control" id="addNodesCollaboratorsCluster">
                                                                        <span class="material-icons">add</span>
                                                                    </li>
                                                                </ul>
                                                            </div>
                                                            <input type="hidden" id="numColaboradoresCluster" value="10" />
                                                            <div class="wrapCol" id="colaboratorsgraphCluster" style="width: 100%; height: 400px;"></div>
                                                        </div>
                                                    </div>                                                    
                                                    <div class="col col-12">
                                                        <div class="wrapCol mt-4">
                                                            <div class="row" id="clusterListUsers">
                                                                
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="tab-pane fade" id="seleccionados-cluster" role="tabpanel" aria-labelledby="seleccionados-cluster-tab">
                                                <div class="row">
                                                    <div class="col col-12 col-section-title font-weight-bold">
                                                        <div class="wrapCol">
                                                            <p>@Html.Translate("LISTADO_INVETIGADORES_SELECCIONADOS")</p>
                                                        </div>
                                                    </div>
                                                    <div class="col col-12 col-perfiles" id="perfiles-stp3-result-cluster">
                                                        <p class="section-title">@Html.Translate("PERFILES") </p>
                                                        
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="botonera">
                                            <a href="javascript:stepsCls.goStep(2)" class="btn btn-outline-primary uppercase">
                                                <span class="material-icons">keyboard_arrow_left</span>
                                                Anterior
                                            </a>
                                            <a href="javascript:stepsCls.goStep(3)" class="btn btn-primary uppercase">
                                                @Html.Translate("GUARDAR_TERMINAR")
                                                <span class="material-icons">keyboard_arrow_right</span>
                                            </a>
                                        </div>
                                    </div>
                                    <!-- END STEP 3 -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <div id="modal-seleccionar-area-tematica" data-backdrop="static" class="modal modal-top fade modal-edicion" tabindex="-1" role="dialog">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <p class="modal-title"><span class="material-icons">folder_open</span>@Html.Translate("SELECCIONAR_AREAS_TEMATICAS")</p>
                            <span class="material-icons cerrar" data-dismiss="modal" aria-label="Close">close</span>
                        </div>
                        <div class="modal-body">
                            <div class="formulario-edicion">
                                <div class="form-group">
                                    <label class="control-label">@Html.Translate("AREAS_TEMATICAS")</label>
                                </div>
                                <div id="panDesplegableSelCat">
                                    <ul class="nav nav-tabs d-none" id="myTab" role="tablist">
                                        <li class="nav-item">
                                            <a class="nav-link active" id="ver-arbol-tab" data-toggle="tab" href="#ver-arbol" role="tab" aria-controls="ver-arbol" aria-selected="true">@Html.Translate("ARBOL")</a>
                                        </li>
                                        @*<li class="nav-item">
                                            <a class="nav-link" id="ver-lista-tab" data-toggle="tab" href="#ver-lista" role="tab" aria-controls="ver-lista" aria-selected="false">@Html.Translate("LISTA")</a>
                                        </li>*@
                                    </ul>
                                    <div class="tab-content pt-0">

                                        <div class="tab-pane fade show active" id="ver-arbol" role="tabpanel" aria-labelledby="ver-arbol-tab">
                                            <div class="divTesArbol divCategorias clearfix">
                                                <div class="buscador-categorias">
                                                    <div class="form-group">
                                                        <input class="filtroRapido form-control not-outline" placeholder="@Html.Translate("BUSCAR_AREA_TEMATICA")" type="text" onkeydown="javascript:if(event.which || event.keyCode){if ((event.which == 13) || (event.keyCode == 13)) {return false;}}" onkeyup="javascript:MVCFiltrarListaSelCatArbol(this, 'panDesplegableSelCat');">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        @*<div class="tab-pane fade" id="ver-lista" role="tabpanel" aria-labelledby="ver-lista-tab">
                                            <div class="divTesLista divCategorias clearfix">
                                                <div class="buscador-categorias">
                                                    <div class="form-group">
                                                        <input class="filtroRapido form-control not-outline" placeholder="@Html.Translate("BUSCA_CATEGORIA")" type="text" onkeydown="javascript:if(event.which || event.keyCode){if ((event.which == 13) || (event.keyCode == 13)) {return false;}}" onkeyup="javascript:stepsCls.MVCFiltrarListaSelCat(this)">
                                                    </div>
                                                </div>
                                            </div>
                                            <input type="hidden" id="txtHackCatTesSel" class="hackCatTesSel" value="c5f38eb9-3d3c-4dd5-8fb7-0c771cb4a044,e9292906-a378-477f-b01e-c6c005be201e,">
                                        </div>*@
                                    </div>
                                </div>
                                <div class="form-actions">
                                    <a href="javascript:void(0)" class="btn btn-primary pmd-ripple-effect btnsave">@Html.Translate("GUARDAR")</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="modal-anadir-topicos-cluster" data-backdrop="static" class="modal modal-top fade" tabindex="-1" role="dialog">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <p class="modal-title"><span class="material-icons">label</span>@Html.Translate("ANADIR_DESCRIPTORES_ESPECIFICOS")</p>
                            <span class="material-icons cerrar" data-dismiss="modal" aria-label="Close">close</span>
                        </div>
                        <div class="modal-body">
                            <div class="formulario-edicion">
                                <div class="custom-form-row">
                                    <div class="form-group full-group">
                                        <label class="control-label d-block">@Html.Translate("DESCRIPTOR_ESPECIFICO")</label>
                                        <input placeholder="Introduce o selecciona un tópico" type="text" name="" id="tagsSearchModalCluster" class="form-control not-outline">
                                        <div class="ac_results" style="position: absolute;width: 100%;display: none;">
                                            <ul>
                                                @* <li class="ac_even">data</li> *@
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="list-wrap tags">
                                    <ul>
                                        @* <li class="background-amarillo">
                                            <a href="javascript: void(0);">
                                                <span class="texto">Compute science</span>
                                            </a>
                                            <span class="material-icons cerrar">close</span>
                                        </li> *@
                                    </ul>
                                </div>
                                <div class="form-actions">
                                    <a href="javascript: void(0);" class="btn btn-primary uppercase btnclosemodal" data-dismiss="modal">@Html.Translate("GUARDAR")</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <div id="modal-anadir-perfil-cluster" class="modal modal-top fade modal-edicion" tabindex="-1" role="dialog">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <p class="modal-title"><span class="material-icons">person</span>@Html.Translate("ANADIR_OTRO_PERFIL")</p>
                            <span class="material-icons cerrar" data-dismiss="modal" aria-label="Close">close</span>
                        </div>
                        <div class="modal-body">
                            <div class="formulario-edicion">
                                <div class="custom-form-row">
                                    <div class="form-group full-group">
                                        <label class="control-label d-block">@Html.Translate("ANADIR_PERFIL")</label>
                                        <input placeholder="Introduce o selecciona un perfil" type="text" name="perfilname" id="input-anadir-perfil" class="form-control not-outline">
                                        <div class="ac_results" style="position: absolute;width: 100%;display: none;">
                                            <ul>
                                                <li class="ac_even">data</li>
                                                <li class="ac_odd">Linked data</li>
                                                <li class="ac_even">World data</li>
                                                <li class="ac_odd">Metadata</li>
                                                <li class="ac_even">Linked data</li>
                                                <li class="ac_odd">Learning object data</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-actions">
                                    <a href="javascript: stepsCls.addPerfilSearch()" class="btn btn-primary uppercase">Guardar</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }   
    </body>
</html>
